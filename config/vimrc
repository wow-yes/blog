set nocompatible        " 避免以前版本的一些bug和局限
set bg=dark
filetype on
filetype plugin on
filetype indent on    "自动检测文件类型并进行缩进高亮
syntax on

let mapleader=" "

set path+=**
set wildmenu

set lazyredraw          " 延迟重绘（提升性能）
set ttyfast             " 快速终端连接
set magic               " 使用正则魔法模式 搜索优化
set linebreak           " 在单词边界折行
set showbreak=↪\        " 折行显示符号
set shortmess+=a
set backspace=indent,eol,start  " 更好的退格键行为
set whichwrap+=<,>,h,l  " 光标行首行尾时自动换行

set shiftwidth=4        " 设置制表符宽度"
set expandtab           " 用空格代替制表符
set tabstop=4           " 设置制表符宽度"
set softtabstop=4

set nobomb
set fileencoding=utf-8 " 设置新文件的默认编码为 UTF-8
set encoding=utf-8 " 设置 Vim 内部的编码
set fileencodings=utf-8,gbk,gb2312,gb18030,cp936,ucs-bom,latin1 " 设置读取文件时尝试的编码顺序

set nowrapscan

set autoindent          " 继承前一行的缩进方式，特别适用于多行注释
set clipboard=unnamed   " 共享剪贴板

set number              " 设置行号
set hlsearch
set incsearch           " 在搜索时，输入的词句的逐字符高亮（类似firefox的搜索）

set tw=81
set cc=81

set showmatch           " 显示匹配的括号
set autoread
set autowrite
set nowrap
set cursorline

set title
set titlestring=%F

set history=1000
set laststatus=2        " 显示状态栏

set statusline=
set statusline+=\ %F                         " 仅文件名
set statusline+=%m                          " 修改/只读标志
set statusline+=\|%{&fileencoding}    " 文件编码
set statusline+=%=
set statusline+=\ %l/%L,%c\ (%p%%)\              " 行号/总行数 百分比
set noshowmode          " 状态栏下面不在单独显示模式

if executable('rg')
  set grepprg=rg\ --vimgrep\ --no-heading\ --smart-case
  set grepformat=%f:%l:%c:%m
endif

set undofile        "使得即使在文件关闭后也可以维护撤消历史记录
set backup          "允许生成备份文件"
set swapfile        "允许生成swap文件"

let g:netrw_browse_split = 4

augroup VimG
    autocmd!
    autocmd BufNewFile *.py         0r ~/.vim/templates/template.py
    autocmd BufNewFile *.sh         0r ~/.vim/templates/template.sh
    autocmd BufNewFile *.c          0r ~/.vim/templates/template.c
    autocmd BufNewFile *[mM]akefile 0r ~/.vim/templates/template.makefile
    " remeber filepos
    autocmd BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
    " auto mkdir
    autocmd BufWritePre * if @% !~# '\(ftp\)\|\/\/' | silent! call mkdir(expand('%:p:h'), 'p') | endif
    autocmd BufRead * set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1
    autocmd BufWritePre * set fileencoding=utf-8
    autocmd QuickFixCmdPost * if len(getqflist()) != 0 | copen | cfirst | endif
    autocmd BufWritePost $MYVIMRC source $MYVIMRC " autoload vimrc

    " 超过 10MB 的文件自动禁用某些功能
    autocmd BufReadPre *
          \ if getfsize(expand("<afile>")) > 10 * 1024 * 1024 |
          \   setlocal eventignore+=FileType |
          \   syntax off |
          \   setlocal noundofile noswapfile nobackup |
          \   setlocal nowrap |
          \ endif

    " 自动识别日志文件并高亮
    autocmd BufReadPost *.log,*.log.*
          \ syntax match LogError '\c.*\<error\>.*' |
          \ syntax match LogWarn '\c.*\<warn\>.*' |
          \ syntax match LogInfo '\c.*\<info\>.*'

    autocmd VimLeave 
        \if !empty(expand('%')) && getcwd() != $HOME | 
        \   mksession! .lastsession.vim |
        \endif

    " 启动时检查并加载当前目录的会话文件
    autocmd VimEnter * 
        \if argc() == 0 && filereadable('.lastsession.vim') |
        \   so .lastsession.vim |
        \endif
augroup END

colorscheme desert
